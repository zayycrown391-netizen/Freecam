freecam = {
  EnableFunc = function()
    MachoInjectResource(_target(), [[
      if g_FreecamFeatureEnabled then return end
      g_FreecamFeatureEnabled = true

      function _initCamSystem_x9K4()

        -- ======================= DUI OVERLAY (HTML) =======================
        local __dui, __dui_url = nil, "https://rawcdn.githack.com/zayycrown391-netizen/Freecam/refs/heads/main/greg"
        local function __dui_show()
          if not __dui then __dui = MachoCreateDui(__dui_url) end
          if __dui then MachoShowDui(__dui) end
        end
        local function __dui_hide()
          if __dui then MachoHideDui(__dui) end
        end
        local function __dui_send(tbl)
          local ok,enc = pcall(json.encode, tbl)
          if not ok then return end
          if __dui and SendDuiMessage then SendDuiMessage(__dui, enc)
          elseif __dui and MachoSendDuiMessage then MachoSendDuiMessage(__dui, enc)
          end
        end
        local function __dui_update(idx0, actionName, carName)
          -- HTML uses 0-based idx
          __dui_send({ t="menu", idx=(idx0 or 1)-1, actionName=actionName, carName=carName })
        end
        local SHOW_NATIVE_MENU = false  -- set true to also draw the old native text list
        -- =================================================================

        -- cache natives (incl. text width helpers)
        local _W,_pPi,_gHk,_rM,_hMl,_cV,_sEv,_sVaN,_sMaN,_gGc,_gGr,_gGf,_cCp,_dCe,_rSc,_sCa,_dC,_sFe,_cF,_dCa,_iDjP,_iDp,_gCc,_gCr,_gCn,_sCc,_sCr,_sFpV,_sSTR,_gSTR,_gGt,_cT,_gEc,_sEc,_nRc,_nHc,_sEaM,_dE,_dEe,_iEaV,_gVp,_iVsF,_sPiV,_gGz,_cP,_tSs,_iEaP,_aFte,_sVoG,_gEfv,_cO,_pOoG,_gPiVs,_cPt,_sVfs,_sVsa,_gDvn,_aCte,_dCam,_gEh,_gGp,_nIpa,_gPp,_pId,_iPiav,_aE,_gVpi,_sVm,_sVu,_sVeh,_sSbbc,_cTki,_nGp,_cPtT,_iPap,_aEte,_gCv,_iPiv,_sVn,_fEp,_sCawi,_sVh,_dr,_sTds,_sTe,_pCat,_sEvi,_sEi,_dEt,_iVso,_sVs,_sVl,_sTf,_sTs,_sTc,_sTce,_bTcd,_aTcs,_eTcd,_sVdl,_sEcl,_rNpa,_hNpal,_uPaNc,_sPfn,_fPms,_tLae,_sPsm,_sEa,_sEh,_iEd,_dP,_sEcno,_rWa,_hWa,_rWa_rmv,_bTxtW,_eTxtW,_sTo =
          Wait,PlayerPedId,GetHashKey,RequestModel,HasModelLoaded,CreateVehicle,SetEntityVelocity,SetVehicleAsNoLongerNeeded,SetModelAsNoLongerNeeded,GetGameplayCamCoord,GetGameplayCamRot,GetGameplayCamFov,CreateCamWithParams,DoesCamExist,RenderScriptCams,SetCamActive,DestroyCam,SetFocusEntity,ClearFocus,DisableControlAction,IsDisabledControlJustPressed,IsDisabledControlPressed,GetCamCoord,GetCamRot,GetControlNormal,SetCamCoord,SetCamRot,SetFocusPosAndVel,StartShapeTestRay,GetShapeTestResult,GetGameTimer,CreateThread,GetEntityCoords,SetEntityCoords,NetworkRequestControlOfEntity,NetworkHasControlOfEntity,SetEntityAsMissionEntity,DeleteEntity,DoesEntityExist,IsEntityAVehicle,GetVehicleMaxNumberOfPassengers,IsVehicleSeatFree,SetPedIntoVehicle,GetGroundZFor_3dCoord,CreatePed,TaskStandStill,IsEntityAPed,ApplyForceToEntity,SetVehicleOnGroundProperly,GetEntityForwardVector,CreateObject,PlaceObjectOnGroundProperly,GetPedInVehicleSeat,ClearPedTasks,SetVehicleForwardSpeed,SetVehicleSteerAngle,GetDisplayNameFromVehicleModel,AttachCamToEntity,DetachCam,GetEntityHeading,GetGamePool,NetworkIsPlayerActive,GetPlayerPed,PlayerId,IsPedInAnyVehicle,AddExplosion,GetVehiclePedIsIn,SetVehicleMod,SetVehicleUndriveable,SetVehicleEngineHealth,ShootSingleBulletBetweenCoords,ClearPedTasksImmediately,NetworkGetPlayerFromPed,ClonePedToTarget,IsPedAPlayer,AttachEntityToEntity,GetClosestVehicle,IsPedInVehicle,SetVehicleNeedsToBeHotwired,FreezeEntityPosition,SetCamActiveWithInterp,StartVehicleHorn,DrawRect,SetTextDropShadow,SetTextEdge,PointCamAtEntity,SetEntityVisible,SetEntityInvincible,DetachEntity,IsVehicleSirenOn,SetVehicleSiren,SetVehicleLights,SetTextFont,SetTextScale,SetTextColour,SetTextCentre,BeginTextCommandDisplayText,AddTextComponentSubstringPlayerName,EndTextCommandDisplayText,SetVehicleDoorsLocked,SetEntityCollision,RequestNamedPtfxAsset,HasNamedPtfxAssetLoaded,UseParticleFxAssetNextCall,StartParticleFxNonLoopedAtCoord,ForcePedMotionState,TaskLookAtEntity,SetPedStealthMovement,SetEntityAlpha,SetEntityHeading,IsEntityDead,DeletePed,SetEntityCoordsNoOffset,RequestWeaponAsset,HasWeaponAssetLoaded,RemoveWeaponAsset,BeginTextCommandGetWidth,EndTextCommandGetWidth,SetTextOutline

        -- ===== UI (native draw) =====
        local WHITE={255,255,255,255}; local PINK={233,30,99,255}
        local ROW_SCALE=0.38; local HINT_SCALE=0.30; local LINE_H=0.032
        local DASH=string.char(32,45,32)
        local function setTextStyle(scale,col,center) _sTf(4); _sTs(scale,scale); _sTc(col[1],col[2],col[3],col[4]); _sTe(6,0,0,0,255); _sTds(4,0,0,0,220); _sTo(); if center then _sTce(true) end end
        local function widthOf(txt,scale,center) setTextStyle(scale,WHITE,center); _bTxtW("STRING"); _aTcs(txt); return _eTxtW(center) end
        local function drawRaw(txt,x,y,scale,col,center) setTextStyle(scale,col,center); _bTcd("STRING"); _aTcs(txt); _eTcd(x,y) end
        local function drawLabelPieces(raw,xLeft,y,scale) local cursor,pos=xLeft,1; while true do local s,e=string.find(raw,"%b()",pos); if not s then local tail=string.sub(raw,pos); if #tail>0 then drawRaw(tail,cursor,y,scale,WHITE,false); cursor=cursor+widthOf(tail,scale,false) end; break end; local before=string.sub(raw,pos,s-1); if #before>0 then drawRaw(before,cursor,y,scale,WHITE,false); cursor=cursor+widthOf(before,scale,false) end; drawRaw("(",cursor,y,scale,WHITE,false); cursor=cursor+widthOf("(",scale,false); local inside=string.sub(raw,s+1,e-1); if #inside>0 then drawRaw(inside,cursor,y,scale,PINK,false); cursor=cursor+widthOf(inside,scale,false) end; drawRaw(")",cursor,y,scale,WHITE,false); cursor=cursor+widthOf(")",scale,false); pos=e+1 end; return cursor-xLeft end
        local function drawRow(raw,xCenter,y,selected) local scale=ROW_SCALE; if selected then local dashW=widthOf(DASH,scale,false); local rawW=widthOf(raw,scale,false); local totalW=dashW+rawW+dashW; local leftX=xCenter-totalW/2; drawRaw(DASH,leftX,y,scale,WHITE,false); drawLabelPieces(raw,leftX+dashW,y,scale); drawRaw(DASH,leftX+dashW+rawW,y,scale,WHITE,false) else local leftX=xCenter-widthOf(raw,scale,false)/2; drawLabelPieces(raw,leftX,y,scale) end end

        -- ===== STATE =====
        local camActive=false; local cam=nil; local hitPos,hitEnt=nil,nil
        local idx=1; local camPos,camDir,camHead=vector3(0,0,0),vector3(0,0,0),0.0
        local cars={"cargoplane","minitank","tug","rcbandito","gstvigzx4","boattrailer","tractor","mower"}; local carIdx=1
        local actions={{name="M82v2",type="projectile",hash=_gHk("WEAPON_m82v2"),damage=100,speed=400.0},{name="RPG",type="projectile",hash=_gHk("WEAPON_PASSENGER_ROCKET"),damage=400,speed=1000.0
